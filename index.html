<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RailVerse (全国版) - MapLibre GL JS Edition</title>

    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />

    <!-- Custom Styles -->
    <link href="css/style.css" rel="stylesheet" />
</head>

<body>

    <div id="map"></div>

    <div id="ui-layer">
        <h1>RailVerse <span style="font-size: 12px; font-weight: normal; opacity: 0.7;">(MapLibre版)</span></h1>
        <div class="subtitle">WebGL高速描画エンジン搭載</div>

        <div id="status-bar">データを読み込み中...</div>

        <div class="mode-switch" onclick="toggleMode()">
            <div class="mode-indicator"></div>
            <div class="mode-label active" id="label-day">DAY (地上)</div>
            <div class="mode-label inactive" id="label-night">NIGHT (地下)</div>
        </div>

        <button id="btn-create-line" class="action-button" onclick="startLineCreation()">＋ 架空路線を作成</button>
    </div>

    <!-- Editor Panel -->
    <div id="editor-panel" style="display:none;">
        <h3>架空路線エディタ</h3>
        <div class="editor-row">
            <label>路線名</label>
            <input type="text" id="edit-line-name" placeholder="例: 新都心線">
        </div>
        <div class="editor-row">
            <label>ラインカラー</label>
            <input type="color" id="edit-line-color" value="#ff0000">
        </div>
        <div class="editor-info">
            マップをクリックして駅を追加してください。<br>
            <span id="edit-station-count">0</span> 駅
        </div>
        
        <div id="edit-station-list" class="station-list-editor">
            <!-- Station inputs will go here -->
        </div>

        <div class="editor-actions">
            <button onclick="cancelLineCreation()" class="btn-cancel">キャンセル</button>
            <button onclick="finishLineCreation()" class="btn-save">保存</button>
        </div>
    </div>

    <!-- Sidebar for Line List -->
    <div id="sidebar">
        <div class="sidebar-header">
            <span>表示中の路線</span>
            <span id="line-count" style="font-size: 12px; color: #888; font-weight: normal;">0路線</span>
        </div>
        <div id="visible-line-list">
            <!-- Dynamically populated -->
            <div style="padding: 20px; text-align: center; color: #999; font-size: 13px;">
                マップを移動すると<br>路線が表示されます
            </div>
        </div>
    </div>

    <!-- Application Scripts -->
    <script src="js/state.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/api.js"></script>
    <script src="js/map.js"></script>

    <script>
        // --- Initialization ---
        window.onload = async function () {
            initMap();
            await fetchExternalMetadata();
            loadAllRailways(); // Start loading everything
        };
    </script>
</body>

</html>